/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package opentest.View;

import java.awt.Image;
import java.awt.image.BufferedImage;
import javax.swing.ImageIcon;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import opentest.Controller.ControllerGUI;
import org.opencv.core.Mat;

/**
 *
 * @author kevin
 */
public class GUIPrincipal extends javax.swing.JFrame {

    
    public GUIPrincipal(ControllerGUI controller) {
        initComponents();
        listen(controller);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setSize(914, 648);
        setLocationRelativeTo(null);
        setVisible(true);
        setResizable(true);
        
    }
    
    public void mostrarMensaje(String mensaje){
        JOptionPane.showMessageDialog(null, mensaje);
    }

    public BufferedImage matToBufferedImage(Mat mat) {
        int width = mat.cols();
        int height = mat.rows();
        int channels = mat.channels();
        
        byte[] sourceData = new byte[width * height * channels];
        mat.get(0, 0, sourceData);

        BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_3BYTE_BGR);
        
        final byte[] targetData = ((java.awt.image.DataBufferByte) image.getRaster().getDataBuffer()).getData();
        
        System.arraycopy(sourceData, 0, targetData, 0, sourceData.length);
        
        return image;
    }
    
    public void updateImage(Mat frame) {
        BufferedImage image = matToBufferedImage(frame);
        //ImageIcon imageCamera = new ImageIcon(image);
        panelCamera.setImage(image);
        //panelCamera.setImageCam(imageCamera);
        panelCamera.repaint();
    }
    
    public PanelCamera getPanelCamera(){
        return panelCamera;
    }
    
    public void listen(ControllerGUI controller){
        btnEncenderCamara.addActionListener(controller);
        btnCapturar.addActionListener(controller);
        btnApagarCamara.addActionListener(controller);
        btnDeteccion.addActionListener(controller);
        btnReconocer.addActionListener(controller);
        btnVolver.addActionListener(controller);
    }
    
    public void setEstadoBtn(boolean estado){
        btnDeteccion.setEnabled(estado);
        btnReconocer.setEnabled(estado);
    }
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        btnCapturar = new javax.swing.JButton();
        btnEncenderCamara = new javax.swing.JButton();
        panelCamera = new opentest.View.PanelCamera();
        btnApagarCamara = new javax.swing.JButton();
        btnDeteccion = new javax.swing.JButton();
        btnReconocer = new javax.swing.JButton();
        btnVolver = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setMinimumSize(new java.awt.Dimension(570, 445));
        setPreferredSize(new java.awt.Dimension(595, 465));
        setResizable(false);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        btnCapturar.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        btnCapturar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/imgIcons/ICaptura.png"))); // NOI18N
        btnCapturar.setActionCommand("Captura");
        btnCapturar.setBorderPainted(false);
        btnCapturar.setContentAreaFilled(false);
        btnCapturar.setMargin(new java.awt.Insets(12, 14, 12, 14));
        getContentPane().add(btnCapturar, new org.netbeans.lib.awtextra.AbsoluteConstraints(370, 550, 90, 50));

        btnEncenderCamara.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        btnEncenderCamara.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/imgIcons/IEncenderCamara.png"))); // NOI18N
        btnEncenderCamara.setActionCommand("EncenderCamara");
        btnEncenderCamara.setBorderPainted(false);
        btnEncenderCamara.setContentAreaFilled(false);
        btnEncenderCamara.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEncenderCamaraActionPerformed(evt);
            }
        });
        getContentPane().add(btnEncenderCamara, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 550, 90, 50));

        panelCamera.setBackground(new java.awt.Color(255, 255, 255));
        panelCamera.setBorder(new javax.swing.border.MatteBorder(null));
        panelCamera.setForeground(new java.awt.Color(255, 255, 255));
        panelCamera.setPreferredSize(new java.awt.Dimension(352, 288));

        javax.swing.GroupLayout panelCameraLayout = new javax.swing.GroupLayout(panelCamera);
        panelCamera.setLayout(panelCameraLayout);
        panelCameraLayout.setHorizontalGroup(
            panelCameraLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 348, Short.MAX_VALUE)
        );
        panelCameraLayout.setVerticalGroup(
            panelCameraLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 288, Short.MAX_VALUE)
        );

        getContentPane().add(panelCamera, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 210, 350, 290));

        btnApagarCamara.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        btnApagarCamara.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/imgIcons/IApagarCamara.png"))); // NOI18N
        btnApagarCamara.setActionCommand("ApagarCamara");
        btnApagarCamara.setBorderPainted(false);
        btnApagarCamara.setContentAreaFilled(false);
        getContentPane().add(btnApagarCamara, new org.netbeans.lib.awtextra.AbsoluteConstraints(270, 550, 90, 50));

        btnDeteccion.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        btnDeteccion.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/imgIcons/IReconocer.png"))); // NOI18N
        btnDeteccion.setActionCommand("DeteccionRostro");
        btnDeteccion.setBorderPainted(false);
        btnDeteccion.setContentAreaFilled(false);
        getContentPane().add(btnDeteccion, new org.netbeans.lib.awtextra.AbsoluteConstraints(470, 550, 90, 50));

        btnReconocer.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        btnReconocer.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/imgIcons/IBuscar.png"))); // NOI18N
        btnReconocer.setActionCommand("Reconocer");
        btnReconocer.setBorderPainted(false);
        btnReconocer.setContentAreaFilled(false);
        getContentPane().add(btnReconocer, new org.netbeans.lib.awtextra.AbsoluteConstraints(570, 550, 90, 50));

        btnVolver.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/imgIcons/ISalir.png"))); // NOI18N
        btnVolver.setActionCommand("Volver");
        btnVolver.setBorderPainted(false);
        btnVolver.setContentAreaFilled(false);
        getContentPane().add(btnVolver, new org.netbeans.lib.awtextra.AbsoluteConstraints(670, 550, 90, 50));

        jLabel1.setBackground(new java.awt.Color(51, 51, 255));
        jLabel1.setFont(new java.awt.Font("Roboto", 1, 24)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(255, 255, 255));
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/imgIcons/Ingreso.png"))); // NOI18N
        jLabel1.setOpaque(true);
        getContentPane().add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 900, 610));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnEncenderCamaraActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEncenderCamaraActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnEncenderCamaraActionPerformed

    /**
     * @param args the command line arguments
     */

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnApagarCamara;
    private javax.swing.JButton btnCapturar;
    private javax.swing.JButton btnDeteccion;
    private javax.swing.JButton btnEncenderCamara;
    private javax.swing.JButton btnReconocer;
    private javax.swing.JButton btnVolver;
    private javax.swing.JLabel jLabel1;
    private opentest.View.PanelCamera panelCamera;
    // End of variables declaration//GEN-END:variables
}
